#!/bin/bash

working_dir="/home/dcashman/WRITE_UP/MstrsProject/experiments"
boots_left=`cat ${working_dir}/boots_left`

#get num boots left from file                                                                                    
if [ $boots_left -gt 0 ]; then


        num=$((1000 - $boots_left))
        #record dmesg
	dmesg > ${working_dir}/dmesg/dmesg_${num}.txt

	#record /proc/1/maps (must set script to be root-owned)
	cat /proc/1/maps > ${working_dir}/proc_map/mmap_${num}.txt

        #decrement boots left
	echo $(($boots_left - 1)) > ${working_dir}/boots_left
        boots_left=`cat ${working_dir}/boots_left`

fi
exit 0
